\input{src/preamble.tex}

\begin{document}
  \frame[plain]{\titlepage}

  \frame[plain]{
    \frametitle{}
    \LARGE{\textbf{Überblick}}
    \vspace{1em}
    \large
    \begin{enumerate}
      \item Problemstellung
      \item Umsetzung des Transpilers
      \item Ergebnisse und Auswertung
      \item Fazit
    \end{enumerate}
  }

  \section{Problemstellung}
    \secframe{1}{Problemstellung}

    \begin{frame}
      \frametitle{Motivation}
      \begin{itemize}
        \item JavaScripts \textbf{dynamische Typisierung} erschwert die Entwicklung korrekter, sicherer und wartbarer Anwendungen~\autocite{NIKHIL:2014,PRADEL:2015,BIERMAN:2014}
        \item Typ von Werten wird zur Laufzeit implizit umgewandelt (\textit{type coercion})
        \item Kritisches Laufzeitverhalten wird zum Teil ignoriert
        \item aber: Erkennung von Programmfehlern durch Einsatz eines \textbf{statischen Typsystems} möglich
        \item Zwei Vertreter: \textit{Flow}~\autocite{FLOW:PAPER} und \textit{TypeScript}~\autocite{TYPESCRIPT:SPEC}
      \end{itemize}
    \end{frame}

    \begin{frame}[fragile]
      \frametitle{Beispiel -- Statische Typisierung durch Flow}
      \begin{lstlisting}
function linearSearch<T>(list: Array<T>, searchValue: T): number | null {
  for (const [index, value] of list.entries()) {
    if (value === searchValue) {
      return index;
    }
  }
  return null;
}

linearSearch<number>([3, 56, 10], 56);           // 1
linearSearch<number>([3, 56, 10], 12);           // null
linearSearch<string>(['foo', 'bar', 'baz'], 3);  // Typfehler
      \end{lstlisting}
    \end{frame}

    \frame{
      \frametitle{Zielsetzung der Masterarbeit}
      \begin{itemize}
        \item Ausgangslage: \textit{Spreadshirt} setzt Flow zur statischen Typisierung von JavaScript-Anwendungen ein
        \item Ziel: Migration bestehender Flow"=Projekte nach TypeScript
        \item Händische Migration fehleranfällig und zeitaufwändig
        \item Lösung: Entwicklung eines \textbf{Transpilers} zur Übersetzung der Flow-Typisierung nach TypeScript
        \item Transpiler = Compiler, der Quelltext einer Programmier"=sprache in eine andere übersetzt
      \end{itemize}
    }

    \begin{frame}[fragile]
      \frametitle{Beispiel einer Typ-Übersetzung}

      \begin{lstlisting}[
        numbers=none,
        basicstyle=\linespread{1.04}\normalsize\ttfamily,
        emph={number,null,undefined},
      ]
// Flow
type MaybeNumber = ?number;


// TypeScript
type MaybeNumber = number | null | undefined;
      \end{lstlisting}
    \end{frame}

    \begin{frame}
      \frametitle{Ziele der Migration zu TypeScript}
      \textbf{Z1}\hspace{0.75em}Erkennung weiterer Typ- und Programmfehler\\[.6em]
      \textbf{Z2}\hspace{0.75em}Unterstützung externer Bibliotheken\\[.6em]
      \textbf{Z3}\hspace{0.75em}Performance der Typüberprüfungen\\[.6em]
      \textbf{Z4}\hspace{0.75em}Zukunftssicherheit und Transparenz der Technologie
    \end{frame}

  \section{Umsetzung}
    \secframe{2}{Umsetzung}

    \begin{frame}
      \frametitle{Technische Anforderungen an den Transpiler}
      \textbf{A1}\hspace{0.75em}Äquivalente und vollständige Übersetzung der Flow-Typen\\[.6em]
      \textbf{A2}\hspace{0.75em}Beibehaltung der Programmsemantik\\[.6em]
      \textbf{A3}\hspace{0.75em}Unterstützung aktueller und vorläufiger JavaScript- sowie\\\hspace{2.05em}JSX-Syntax\\[.6em]
      \textbf{A4}\hspace{0.75em}Verarbeitung gesamter Projektverzeichnisse\\[.6em]
      \textbf{A5}\hspace{0.75em}Beibehaltung der Quelltextformatierung
    \end{frame}

    \begin{frame}
      \frametitle{Implementierung als Babel-Plugin}
      \begin{itemize}
        \item \textit{Babel}~\autocite{BABEL} als Grundlage der Implementierung
        \item Babel = Transpiler für JavaScript
        \item unterstützt anders als Alternativen alle\\geforderten Syntaxarten
        \item Erweiterung durch Plugins möglich
        \item sehr ausgereiftes Projekt
      \end{itemize}
    \end{frame}

    \begin{frame}
      \frametitle{Programmtransformation durch Babel}
      \begin{enumerate}
        \item Parsen des Eingabequelltexts\linebreak$\Rightarrow$ abstrakter Syntaxbaum (AST) des Programms
        \item \textbf{Programmtransformation} durch Manipulation der AST-Knoten mittels \textit{Besucher-Entwurfsmuster}
        \item Generierung des Ausgabequelltexts
      \end{enumerate}
    \end{frame}

    \begin{frame}[fragile]
      \frametitle{Transformation des AST -- Beispiel}

      \begin{columns}
        \begin{column}{.48\textwidth}
          \begin{lstlisting}[numbers=none]
// @flow
type Alias = mixed;
          \end{lstlisting}
          \vspace{5mm}
          \ttfamily
          \begin{forest}
            for tree = {l=1.6cm, s sep=0.4cm}
            [Program
              [TypeAlias, edge label={node[edge]{body}}
                [Identifier, edge label={node[edge]{id}}
                  [\enquote{Alias}, edge label={node[edge]{name}}]
                ]
                [MixedTypeAnnotation, edge label={node[edge]{right}}]
              ]
            ]
          \end{forest}
        \end{column}
        \begin{column}{.04\textwidth}

        \end{column}
        \begin{column}{.48\textwidth}
          \begin{lstlisting}[numbers=none]
  // TypeScript
  type Alias = unknown;
          \end{lstlisting}
          \vspace{5mm}
          \ttfamily
          \begin{forest}
            for tree = {l=1.6cm, s sep=0.5cm}
            [Program
              [TSTypeAliasDeclaration, edge label={node[edge]{body}}
                [Identifier, edge label={node[edge]{id}}
                  [\enquote{Alias}, edge label={node[edge]{name}}]
                ]
                [TSUnknownKeyword, edge label={node[edge]{typeAnnotation}}]
              ]
            ]
          \end{forest}
        \end{column}
      \end{columns}
    \end{frame}

    \begin{frame}[plain]
      % \frametitle{Architektur}
      \begin{columns}
        \column{\dimexpr\paperwidth-6mm}
        \begin{figure}
          \includegraphics[width=\textwidth]{src/figures/architecture-overview.pdf}
        \end{figure}
      \end{columns}
    \end{frame}

    % \begin{frame}
    %   \frametitle{Spezialfälle}
    %   TODO: Spezialfälle der Transformation
    % \end{frame}

  \section{Ergebnisse}
    \secframe{3}{Ergebnisse und\\*\hspace{2.05em}Auswertung}

    \begin{frame}
      \frametitle{Durchführung der Migration}
      \begin{itemize}
        \item Zwei Projekte von Spreadshirt wurden mit Hilfe des Transpilers erfolgreich migriert
        \item aber: daraufhin zahlreiche neue Typfehler
        \item manuelle Korrektur dieser Fehler notwendig
      \end{itemize}
    \end{frame}

    \subsection{Ziele}
      \begin{frame}
        \LARGE\textbf{Erfüllung der Zielvorgaben}
      \end{frame}

      \begin{frame}
        \frametitle{Z1~~Erkennung weiterer Typ- und Programmfehler}
      \end{frame}

      \begin{frame}
        \frametitle{Z2~~Unterstützung externer Bibliotheken}
      \end{frame}

      \begin{frame}
        \frametitle{Z3~~Performance der Typüberprüfungen}
      \end{frame}

      \begin{frame}
        \frametitle{Z4~~Zukunftssicherheit und Transparenz}
      \end{frame}

    \subsection{Technische Anforderungen}
      \begin{frame}
        \LARGE\textbf{Erfüllung der technischen Anforderungen}
      \end{frame}

      \begin{frame}
        \frametitle{A1~~Äquivalente und vollständige Übersetzungen}
      \end{frame}

      \begin{frame}
        \frametitle{A2~~Beibehaltung der Programmsemantik}
      \end{frame}

      \begin{frame}
        \frametitle{A3~~Unterstützung von JavaScript- und JSX-Syntax}
      \end{frame}

      \begin{frame}
        \frametitle{A4~~Verarbeitung gesamter Projektverzeichnisse}
      \end{frame}

      \begin{frame}
        \frametitle{A5~~Beibehaltung der Quelltextformatierung}
      \end{frame}

  \section{Fazit}
    \secframe{4}{Fazit}

    \begin{frame}
      \frametitle{Fazit}

      \begin{block}{Erfüllung der Ziele}
        \begin{enumerate}
          \item Erkennung weiterer Typ- und Programmfehler
          \item Unterstützung externer Bibliotheken
          \item Performance der Typüberprüfungen
          \item Zukunftssicherheit und Transparenz der Technologie
        \end{enumerate}
      \end{block}
    \end{frame}

  \appendix

    \begin{frame}[noframenumbering,plain]
      % empty
    \end{frame}

  \section{Anhang}
    \setbeamertemplate{footline}{}

    \begin{frame}[noframenumbering]
      \frametitle{Evaluation bestehender Werkzeuge}
      \input{src/tables/tools.tex}
    \end{frame}

    \frame[allowframebreaks,noframenumbering,plain] {
      \frametitle{Quellenverzeichnis}
      \printbibliography
    }

\end{document}
